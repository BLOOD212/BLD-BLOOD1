const pizzaCondimenti = [
  '*Formaggio ğŸ§€*',
  '*Salsa ğŸ…*',
  '*Wurstel ğŸ–*',
  '*Patatine ğŸŸ*',
  '*Salame ğŸ–*',
  '*Piccante ğŸ”¥*',
  '*Ananas ğŸ*',
  '*Acciughe ğŸŸ*',
  '*Mozzarella ğŸ§€*',
  '*Pistacchio ğŸŒ°*',
  '*Bufala ğŸƒ*',
  '*Mortadella ğŸ–*',
  '*Prosciutto ğŸ–*',
  '*Funghi ğŸ„*',
  '*Olive ğŸ«’*',
  '*Capricciosa ğŸ•*',
  '*GruyÃ¨re ğŸ§€*',
  '*Gombas ğŸ„*',
  '*Peperoni ğŸ”¥*',
  '*Prosciutto crudo ğŸ–*',
  '*Ricotta ğŸ§€*',
  '*Spinaci ğŸ¥—*',
  '*Tonno ğŸŸ*',
  '*Zucchini ğŸ¥’*',
  '*Carne ğŸ–*',
  '*Pollo ğŸ—*',
  '*Salsiccia ğŸ–*',
  '*Bacon ğŸ–*',
  '*Arugula ğŸ¥—*',
  '*Pomodoro ğŸ…*',
  '*Aglio ğŸ§„*',
  '*Cipolla ğŸ§…*',
  '*Mais ğŸŒ½*',
  '*JalapeÃ±o ğŸ”¥*',
  '*Pine Nuts ğŸŒ°*',
  '*Prosciutto di Parma ğŸ–*',
  '*Soppressata ğŸ–*',
  '*Burrata ğŸ§€*',
  '*Graciano ğŸ§€*',
  '*Scamorza ğŸ§€*',
  '*Asparagi ğŸ¥—*',
  '*Broccoli ğŸ¥—*',
  '*Cavolfiore ğŸ¥—*',
  '*Cavolo ğŸ¥—*',
  '*Feta ğŸ§€*',
  '*Gualda ğŸ§€*',
  '*Prosciutto affumicato ğŸ–*',
  '*Salsiccia di maiale ğŸ–*',
  '*Salsiccia di pollo ğŸ–*',
  '*Salsiccia di tacchino ğŸ–*',
  '*Salsiccia di vitello ğŸ–*',
  '*Salsiccia piccante ğŸ”¥*',
  '*Salsiccia vegetale ğŸ–*',
  '*Sottaceti ğŸ¥—*',
  '*Spezi ğŸ§€*',
  '*Stracchino ğŸ§€*',
  '*Tartufi ğŸŒ°*',
  '*Trippa ğŸ²*',
  '*Uova ğŸ¥š*',
  '*Vegan ğŸ–*',
  '*Vegetariano ğŸ¥—*',
  '*Zucca ğŸ¥”*',
  '*Melone ğŸˆ*',
  '*Prosciutto di Milano ğŸ–*',
  '*Salsiccia di Napoli ğŸ–*',
  '*Cacciatore ğŸ–*',
  '*Pepperoni ğŸ–*',
  '*Chorizo ğŸ–*',
  '*Mortadella di Bologna ğŸ–*',
  '*Prosciutto di Toscana ğŸ–*',
  '*Salsiccia di Toscana ğŸ–*',
  '*Funghi porcini ğŸ„*',
  '*Funghi champignons ğŸ„*',
  '*Funghi shiitake ğŸ„*',
  '*Funghi oyster ğŸ„*',
  '*Funghi enoki ğŸ„*',
  '*Funghi crimini ğŸ„*',
  '*Funghi portobello ğŸ„*',
  '*Funghi morel ğŸ„*',
  '*Funghi chanterelle ğŸ„*',
  '*Funghi lobster ğŸ„*',
  '*Funghi maitake ğŸ„*',
  '*Funghi reishi ğŸ„*',
  '*Pomodoro cherry ğŸ…*',
  '*Pomodoro datterino ğŸ…*',
  '*Pomodoro cuore ğŸ…*',
  '*Pomodoro ciliegino ğŸ…*',
  '*Pomodoro grappolo ğŸ…*',
  '*Pomodoro insalata ğŸ…*',
  '*Pomodoro pachino ğŸ…*',
  '*Pomodoro pelato ğŸ…*',
  '*Pomodoro piccato ğŸ…*',
  '*Pomodoro ramato ğŸ…*',
  '*Pomodoro San Marzano ğŸ…*',
  '*Pomodoro tondo ğŸ…*',
  '*Aglio nero ğŸ§„*',
  '*Aglio bianco ğŸ§„*',
  '*Aglio rosso ğŸ§„*',
  '*Aglio elefante ğŸ§„*',
  '*Cipolla bianca ğŸ§…*',
  '*Cipolla rossa ğŸ§…*',
  '*Cipolla gialla ğŸ§…*',
  '*Cipolla cipollina ğŸ§…*',
  '*Cipolla tropea ğŸ§…*',
  '*Peperoncino verde ğŸ”¥*',
  '*Peperoncino rosso ğŸ”¥*',
  '*Peperoncino giallo ğŸ”¥*',
  '*Peperoncino habanero ğŸ”¥*',
  '*Peperoncino jalapeÃ±o ğŸ”¥*',
  '*Peperoncino serrano ğŸ”¥*',
  '*Peperoncino thai ğŸ”¥*',
  '*Peperoncino calabrese ğŸ”¥*',
  '*Peperoncino diavolo ğŸ”¥*',
  '*Peperoncino peperoncino ğŸ”¥*',
  '*Peperoncino piccante ğŸ”¥*',
  '*Peperoncino rosso piccante ğŸ”¥*',
  '*Peperoncino verde piccante ğŸ”¥*',
  '*Peperoncino giallo piccante ğŸ”¥*',
];

const risposte = [
  'Pizza perfetta!',
  'Che schifo!',
  'Mi piace!',
  'Non mi piace!',
  'Ãˆ troppo piccante!',
  'Ãˆ troppo salata!',
  'Ãˆ troppo dolce!',
  'Ãˆ troppo secca!',
  'Ãˆ troppo umida!',
  'Ãˆ troppo buona!',
  'Ãˆ troppo cattiva!',
  'Mi fa schifo!',
  'Mi fa ridere!',
  'Mi fa piangere!',
  'Mi fa arrabbiare!',
  'Mi fa felice!',
  'Mi fa triste!',
  'Mi fa paura!',
  'Mi fa sorpresa!',
  'Mi fa disgusto!',
  'Mi fa noia!',
  'Mi fa dormire!',
  'Mi fa svegliare!',
  'Mi fa ballare!',
  'Mi fa cantare!',
  'Mi fa suonare!',
  'Mi fa scrivere!',
  'Mi fa leggere!',
  'Mi fa pensare!',
  'Mi fa sognare!',
  'Mi fa volare!',
  'Mi fa cadere!',
  'Mi fa correre!',
  'Mi fa fermare!',
  'Mi fa iniziare!',
  'Mi fa finire!',
];

const playAgainButtons = () => [{ name: 'quick_reply', buttonParamsJson: JSON.stringify({ display_text: 'Ordina un\'altra pizza! ğŸ•', id: `.pizza` }) }];

let handler = async (m, { conn, args }) => {
  let frasi = [
    `ğŸ• *Scegli i condimenti per la tua pizza!*`,
    `ğŸ”¥ *Personalizza la tua pizza!*`,
    `ğŸŒŸ *Crea la tua pizza ideale!*`,
    `ğŸ§‚ *Scegli i tuoi condimenti preferiti!*`,
  ];

  if (global.pizzaGame?.[m.chat]) {
    return m.reply('âš ï¸ *C\'Ã¨ giÃ  una partita attiva in questo gruppo!*');
  }

  const cooldownKey = `pizza_${m.chat}`;
  const lastGame = global.cooldowns?.[cooldownKey] || 0;
  const now = Date.now();
  const cooldownTime = 5000;
  if (now - lastGame < cooldownTime) {
    const remainingTime = Math.ceil((cooldownTime - (now - lastGame)) / 1000);
    return m.reply(`â³ *Aspetta ancora ${remainingTime} secondi prima di avviare un nuovo gioco!*`);
  }

  global.cooldowns = global.cooldowns || {};
  global.cooldowns[cooldownKey] = now;

  let frase = frasi[Math.floor(Math.random() * frasi.length)];
  let messaggio = '*Scegli i condimenti per la tua pizza:*' + '\n\n';
  pizzaCondimenti.forEach((condimento, index) => {
    messaggio += `${index + 1}. ${condimento}\n`;
  });
  messaggio += '\n*Rispondi con i numeri dei condimenti separati da virgola (es. 1, 2, 3)*\n*Scrivi "fine" per terminare la tua pizza*';

  try {
    let msg = await conn.sendMessage(m.chat, { text: messaggio, footer: 'ğŸ• ğ–‡ğ–‘ğ–”ğ–”ğ–‰ğ–‡ğ–”ğ–™ ğŸ•' }, { quoted: m });
    global.pizzaGame =